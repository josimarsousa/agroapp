<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/navbar-modern.css">
    <link rel="stylesheet" href="/css/menu-override.css">
    <link rel="stylesheet" href="/css/agroapp-theme.css">
</head>
<body>
<%- include('../partials/header') %>

<div class="container">
    <div class="page-container">
        <div class="page-header">
            <div class="page-header-content">
                <div class="page-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 7C16 9.2 14.2 11 12 11S8 9.2 8 7 9.8 3 12 3 16 4.8 16 7ZM12 14C8.7 14 6 16.7 6 20V21H18V20C18 16.7 15.3 14 12 14Z" fill="currentColor"/>
                        <path d="M15.5 7.5L17 9L20 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h1><%= title %></h1>
            </div>
            <div class="page-actions">
                <a href="/users/new" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Adicionar Novo Usuário
                </a>
            </div>
        </div>

        <div class="page-content">
            <% if (typeof errorMessage !== 'undefined' && errorMessage && errorMessage.length > 0) { %>
                <div class="alert alert-danger">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                        <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
                        <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <%= errorMessage %>
                </div>
            <% } %>

            <% if (typeof successMessage !== 'undefined' && successMessage && successMessage.length > 0) { %>
                <div class="alert alert-success">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <%= successMessage %>
                </div>
            <% } %>

            <% if (users.length > 0) { %>
                <div class="card">
                    <div class="card-header">
                        <h3>Lista de Usuários</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">ID</th>
                                        <th style="min-width: 180px;">Nome de Usuário</th>
                                        <th style="width: 140px;">Função</th>
                                        <th style="width: 180px;">Criado Em</th>
                                        <th style="width: 180px;">Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% users.forEach(user => { %>
                                        <tr>
                                            <td data-label="ID" style=" width: 30px;"><span class="badge badge-primary">#<%= user.id %></span></td>
                                            <td data-label="Nome de Usuário" style="min-width: 180px; text-align: left;"><strong><%= user.username %></strong></td>
                                            <td data-label="Função" style="width: 140px; text-align: left;">
                                                <span class="badge <%= user.role === 'admin' ? 'badge-primary' : 'badge-secondary' %>">
                                                    <%= user.role === 'admin' ? 'Administrador' : 'Usuário' %>
                                                </span>
                                            </td>
                                            <td data-label="Criado Em" style="width: 180px; text-align: left;"><%= user.created_at.toLocaleString('pt-BR') %></td>
                                            <td data-label="Ações" class="actions" style="width: 180px; text-align: left;">
                                                <div class="d-flex gap-2">
                                                    <a href="/users/edit/<%= user.id %>" class="btn btn-primary btn-sm">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M18.5 2.50023C18.8978 2.1024 19.4374 1.87891 20 1.87891C20.5626 1.87891 21.1022 2.1024 21.5 2.50023C21.8978 2.89805 22.1213 3.43762 22.1213 4.00023C22.1213 4.56284 21.8978 5.1024 21.5 5.50023L12 15.0002L8 16.0002L9 12.0002L18.5 2.50023Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                        </svg>
                                                        Editar
                                                    </a>
                                                    <form action="/users/delete/<%= user.id %>" method="POST" onsubmit="return confirm('Tem certeza que deseja excluir este usuário?');" class="d-inline">
                                                        <button type="submit" class="btn btn-danger btn-sm">
                                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                <polyline points="3,6 5,6 21,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                                <path d="M19,6V20A2,2 0 0,1 17,22H7A2,2 0 0,1 5,20V6M8,6V4A2,2 0 0,1 10,2H14A2,2 0 0,1 16,4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                            </svg>
                                                            Excluir
                                                        </button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            <% } else { %>
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 7C16 9.2 14.2 11 12 11S8 9.2 8 7 9.8 3 12 3 16 4.8 16 7ZM12 14C8.7 14 6 16.7 6 20V21H18V20C18 16.7 15.3 14 12 14Z" fill="currentColor"/>
                        </svg>
                    </div>
                    <h3>Nenhum usuário cadastrado</h3>
                    <p class="text-muted mb-3">Não há usuários registrados no sistema ainda.</p>
                    <a href="/users/new" class="btn btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Cadastrar Primeiro Usuário
                    </a>
                </div>
            <% } %>
        </div>
    </div>
</div>

<script src="/js/script.js"></script>
</body>
</html>